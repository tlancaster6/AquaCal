# Example configuration for AquaCal calibration pipeline
# Copy this file and modify for your setup

board:
  squares_x: 8           # Number of squares in X direction
  squares_y: 6           # Number of squares in Y direction
  square_size: 0.030     # Square size in meters (30mm)
  marker_size: 0.022     # ArUco marker size in meters (22mm)
  dictionary: "DICT_4X4_50"  # ArUco dictionary name
  # legacy_pattern: false  # Set to true if board has marker in top-left cell (pre-OpenCV 4.6)

# Optional: use a different board for in-air intrinsic calibration
# If omitted, the board above is used for both intrinsic and extrinsic steps
# intrinsic_board:
#   squares_x: 12
#   squares_y: 9
#   square_size: 0.025
#   marker_size: 0.018
#   dictionary: "DICT_4X4_100"
#   # legacy_pattern: false  # Set to true if board has marker in top-left cell

# The first camera listed is the reference camera (world origin)
cameras:
  - cam0
  - cam1
  - cam2
  - cam3
  # Camera names are flexible â€” use any string that matches your video filenames

# Optional: cameras needing 8-coefficient rational distortion model
# Use for wide-angle lenses where the standard 5-coefficient model is insufficient
# rational_model_cameras:
#   - cam2

# Optional: auxiliary cameras registered post-hoc against the primary calibration
# These cameras go through intrinsic calibration and detection, but are excluded
# from joint optimization (Stages 2-3). Useful for wide-angle overview cameras.
# auxiliary_cameras:
#   - center_cam

# Optional: cameras using equidistant fisheye projection model
# Must be a subset of auxiliary_cameras. Must not overlap with rational_model_cameras.
# Use for wide-angle lenses (e.g. 2.8mm) where pinhole+polynomial distortion fails.
# fisheye_cameras:
#   - overview_cam  # Must also be in auxiliary_cameras. Uses equidistant fisheye model.

paths:
  intrinsic_videos:
    cam0: "/path/to/intrinsic/cam0.mp4"
    cam1: "/path/to/intrinsic/cam1.mp4"
    cam2: "/path/to/intrinsic/cam2.mp4"
    cam3: "/path/to/intrinsic/cam3.mp4"
  extrinsic_videos:
    cam0: "/path/to/extrinsic/cam0.mp4"
    cam1: "/path/to/extrinsic/cam1.mp4"
    cam2: "/path/to/extrinsic/cam2.mp4"
    cam3: "/path/to/extrinsic/cam3.mp4"
  output_dir: "/path/to/calibration_output"

interface:
  n_air: 1.0             # Refractive index of air
  n_water: 1.333         # Refractive index of water (1.333 for fresh water at 20C)
  normal_fixed: false    # If true, assume reference camera is perpendicular to water surface

  # Optional: approximate camera-to-water-surface distances (meters)
  # Improves Stage 3 initialization
  # initial_distances:
  #   cam0: 0.20
  #   cam1: 0.20
  #   cam2: 0.20
  #   cam3: 0.20

optimization:
  robust_loss: "huber"   # Options: "huber", "soft_l1", "linear"
  loss_scale: 1.0        # Residual scale for robust loss (pixels)
  # max_calibration_frames: 150  # Max frames for Stage 3/4 optimization (null = no limit)
                                  # Stages 1-2 still use all frames. Reduces memory and runtime.
  # refine_intrinsics: false  # Stage 4: also optimize focal lengths and principal points
                                # Only enable after Stage 3 converges reliably
  # refine_auxiliary_intrinsics: false  # Stage 4b: also optimize auxiliary camera
                                         # focal lengths and principal points.
                                         # Requires auxiliary_cameras to be set.

detection:
  min_corners: 8         # Minimum corners per frame to use detection
  min_cameras: 2         # Minimum cameras seeing board to use frame
  frame_step: 5          # Process every Nth frame (1 = all frames)

validation:
  holdout_fraction: 0.2  # Fraction of frames held out for validation
  save_detailed_residuals: true  # Save per-corner residual data
