---
phase: 04-example-data
plan: 03
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - src/aquacal/datasets/data/manifest.json
autonomous: false

must_haves:
  truths:
    - "Real calibration dataset is uploaded to Zenodo with a DOI"
    - "Manifest file is updated with Zenodo record ID and SHA256 checksum for real-rig dataset"
    - "load_example('real-rig') downloads and loads the real dataset successfully"
  artifacts:
    - path: "src/aquacal/datasets/data/manifest.json"
      provides: "Updated manifest with real Zenodo record IDs and checksums"
      contains: "zenodo_record_id"
  key_links:
    - from: "src/aquacal/datasets/data/manifest.json"
      to: "Zenodo"
      via: "Record IDs pointing to hosted dataset files"
      pattern: "zenodo_record_id"
---

<objective>
Prepare and upload real calibration dataset to Zenodo, then update the manifest so `load_example('real-rig')` works end-to-end.

Purpose: Researchers need access to a real-world calibration dataset from a production rig to validate AquaCal against non-synthetic data. This plan handles dataset preparation, Zenodo upload, and manifest configuration.

Output: Real dataset on Zenodo with DOI, updated manifest.json, working `load_example('real-rig')`.
</objective>

<execution_context>
@C:/Users/tucke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/tucke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-example-data/04-CONTEXT.md
@.planning/phases/04-example-data/04-RESEARCH.md
@.planning/phases/04-example-data/04-01-SUMMARY.md
@.planning/phases/04-example-data/04-02-SUMMARY.md
@src/aquacal/datasets/data/manifest.json
@src/aquacal/datasets/loader.py
@src/aquacal/datasets/download.py
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Prepare and upload real calibration dataset to Zenodo</name>
  <files>src/aquacal/datasets/data/manifest.json</files>
  <action>
CHECKPOINT: Human action required. The download infrastructure (Plan 02) is ready to fetch datasets from Zenodo. Now we need the actual real-world dataset uploaded. Claude cannot do this — it requires access to production rig data and Zenodo account authentication.
  </action>
  <verify>User provides Zenodo record ID, SHA256 checksum, and file size (or types "skip" to defer).</verify>
  <done>Real dataset ZIP uploaded to Zenodo with DOI, or explicitly deferred.</done>
  <what-built>The download infrastructure (Plan 02) is ready to fetch datasets from Zenodo. Now we need the actual real-world dataset uploaded.</what-built>
  <how-to-verify>
This task requires human action because the real calibration data lives on local hardware and Zenodo upload requires account authentication.

**Steps for the user:**

1. **Prepare the dataset:**
   - Extract frames from production rig videos (9+ cameras)
   - Organize into directory structure:
     ```
     real-rig/
     ├── intrinsic/
     │   ├── cam0/
     │   │   ├── frame0000.jpg
     │   │   └── ...
     │   └── ...
     ├── extrinsic/
     │   ├── cam0/
     │   │   ├── frame0000.jpg
     │   │   └── ...
     │   └── ...
     ├── config.yaml          # AquaCal calibration config for this dataset
     └── reference_calibration.json  # Result from a high-quality calibration run (low framestep)
     ```
   - Use JPEG quality 95 to keep size manageable
   - Target: <200MB total ZIP
   - Reference calibration should use a much lower framestep (more frames) than what ships in the example dataset

2. **Upload to Zenodo:**
   - Go to https://zenodo.org/deposit/new
   - Upload `real-rig.zip`
   - Set metadata:
     - Title: "AquaCal Example Dataset: Real Multi-Camera Underwater Rig"
     - Description: Include camera count, frame counts, rig geometry summary
     - Keywords: calibration, underwater, multi-camera, charuco, refractive
     - License: MIT (or CC-BY-4.0 for data)
     - Creators: Tucker Lancaster
   - Publish and note the DOI and record ID

3. **Provide the following information to Claude:**
   - Zenodo record ID (number from URL)
   - SHA256 checksum of the ZIP file (run: `sha256sum real-rig.zip` or `certutil -hashfile real-rig.zip SHA256`)
   - File size in bytes
   - (Optional) Also upload synthetic-medium.zip and synthetic-large.zip if pre-generated

  </how-to-verify>
  <resume-signal>Provide the Zenodo record ID, SHA256 checksum, and file size. Type "skip" if deferring real dataset to a later phase.</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Update manifest with Zenodo record IDs and verify end-to-end download</name>
  <files>
    src/aquacal/datasets/data/manifest.json
  </files>
  <action>
Using the Zenodo record ID, SHA256 checksum, and file size provided by the user in Task 1:

1. Update `src/aquacal/datasets/data/manifest.json`:
   - Set `zenodo_record_id` for `real-rig` entry
   - Set `checksum_sha256` for `real-rig` entry
   - Set `size_bytes` for `real-rig` entry
   - If user also uploaded synthetic-medium and synthetic-large, update those entries too

2. Verify end-to-end: `python -c "from aquacal.datasets import load_example; ds = load_example('real-rig'); print(f'Loaded {ds.name}: {ds.type}')"` — should download, extract, and load successfully

3. Verify cache: Check that `./aquacal_data/real-rig/` exists after download with expected structure

If user typed "skip": Update manifest with a comment noting real dataset is deferred. Change loader to give a clearer message for datasets with null Zenodo IDs. Mark this plan as complete with a note that real dataset upload is pending.
  </action>
  <verify>
If real dataset uploaded: `python -c "from aquacal.datasets import load_example; ds = load_example('real-rig'); print(f'Loaded: {ds.name}, type={ds.type}')"` — downloads and loads successfully

If skipped: `python -c "from aquacal.datasets import load_example; load_example('real-rig')"` — raises NotImplementedError with helpful message
  </verify>
  <done>
- Manifest updated with real Zenodo record ID and checksum (or marked as deferred)
- load_example('real-rig') either downloads successfully or gives clear deferred message
- No regressions in existing tests
  </done>
</task>

</tasks>

<verification>
1. Manifest file has valid Zenodo record IDs (or explicit null with documentation)
2. End-to-end download works for at least one Zenodo-hosted dataset (or deferred cleanly)
3. `python -m pytest tests/ -m "not slow" --tb=short` — no regressions
</verification>

<success_criteria>
- Real dataset available on Zenodo with DOI (or explicitly deferred with tracking)
- Manifest updated with download metadata
- load_example() works end-to-end for available datasets
- Clear error messages for unavailable datasets
</success_criteria>

<output>
After completion, create `.planning/phases/04-example-data/04-03-SUMMARY.md`
</output>
