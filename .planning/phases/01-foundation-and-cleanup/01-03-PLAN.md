---
phase: 01-foundation-and-cleanup
plan: 03
type: execute
wave: 2
depends_on: ["01-01", "01-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Package builds successfully as sdist and wheel"
    - "Package installs in a fresh venv and imports correctly"
    - "Installed package reports correct version"
    - "No legacy dev/ references remain in tracked files"
  artifacts: []
  key_links:
    - from: "pyproject.toml"
      to: "src/aquacal/__init__.py"
      via: "setuptools package discovery"
      pattern: "where.*src"
---

<objective>
Build the package and validate installation works correctly.

Purpose: Satisfy PKG-01 (pip installable) and PKG-04 (installs on Python 3.10-3.12). Verify the cleanup and metadata changes from Plans 01 and 02 produce a working, installable package.
Output: Validated package build, confirmed import works, cross-platform checkpoint.
</objective>

<execution_context>
@C:/Users/tucke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/tucke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-cleanup/01-01-SUMMARY.md
@.planning/phases/01-foundation-and-cleanup/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build package and validate local installation</name>
  <files></files>
  <action>
    1. **Build the package:**
       ```bash
       python -m pip install build --quiet
       python -m build
       ```
       Verify both sdist (.tar.gz) and wheel (.whl) are created in `dist/`.

    2. **Create a fresh venv and install from wheel:**
       ```bash
       python -m venv /c/Users/tucke/tmp/test_aquacal
       source /c/Users/tucke/tmp/test_aquacal/Scripts/activate
       pip install dist/aquacal-*.whl
       ```

    3. **Validate installation:**
       ```bash
       python -c "import aquacal; print(aquacal.__version__)"
       python -c "from aquacal.core.refractive_geometry import refractive_project; print('projection OK')"
       python -c "from aquacal.calibration.pipeline import CalibrationPipeline; print('pipeline OK')"
       ```

    4. **Check package metadata:**
       ```bash
       pip show aquacal
       ```
       Verify: Name, Version, Summary, Home-page, Author fields are populated.

    5. **Cleanup test venv:**
       ```bash
       deactivate
       rm -rf /c/Users/tucke/tmp/test_aquacal
       ```

    6. **Verify no dev/ references remain in git-tracked files:**
       ```bash
       git ls-files | xargs grep -l "dev/DESIGN\|dev/GEOMETRY\|dev/KNOWLEDGE_BASE\|dev/TASKS\|dev/CHANGELOG\|dev/handoffs" 2>/dev/null
       ```
       Should return empty (no tracked files reference old dev/ paths).
       Note: .planning/ files may reference dev/ in historical context -- that is acceptable.
       Only flag references in source code, CLAUDE.md, or .claude/ config files.
  </action>
  <verify>
    - `ls dist/aquacal-*.whl dist/aquacal-*.tar.gz` shows both distribution files
    - Fresh venv install succeeded without errors
    - `import aquacal` works in fresh venv
    - `pip show aquacal` displays correct metadata
    - No stale dev/ references in tracked source/config files
  </verify>
  <done>Package builds and installs correctly from wheel in a fresh venv. Metadata displays correctly. No legacy references in tracked files.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Cross-platform installation verification</name>
  <what-built>
    Plans 01-03 completed: repository cleaned (dev/ removed, .claude/ streamlined, CLAUDE.md updated), package metadata updated (pyproject.toml URLs/classifiers, CHANGELOG.md, CONTRIBUTING.md), and local installation validated on Windows.
  </what-built>
  <how-to-verify>
    1. **Review cleanup:** Run `ls dev/` to confirm dev/ is gone. Run `ls .claude/agents/` to confirm old agents removed.
    2. **Review new files:** Open `CHANGELOG.md` and `CONTRIBUTING.md` at repo root. Check content looks right.
    3. **Review pyproject.toml:** Check the project.urls and classifiers sections look correct.
    4. **Review CLAUDE.md:** Confirm references point to .planning/ not dev/.
    5. **(Optional) Cross-platform test:** If you have access to Linux/macOS or another Python version (3.10, 3.11, 3.12), test:
       ```bash
       python -m venv /tmp/test_aquacal
       source /tmp/test_aquacal/bin/activate
       pip install dist/aquacal-*.whl
       python -c "import aquacal; print(aquacal.__version__)"
       deactivate && rm -rf /tmp/test_aquacal
       ```
    6. **(Optional) TestPyPI upload:** If you want to verify PyPI metadata rendering now:
       ```bash
       pip install twine
       twine upload --repository testpypi dist/*
       # Visit https://test.pypi.org/project/aquacal/ to check metadata
       ```
       This can also be deferred to Phase 6.
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 1, or describe any issues to fix.</resume-signal>
</task>

</tasks>

<verification>
- Package builds as sdist and wheel without errors
- Package installs and imports in fresh venv
- All Phase 1 success criteria met:
  1. User can install AquaCal via pip (validated locally, cross-platform is checkpoint)
  2. Repository contains no legacy dev artifacts (dev/ removed, .claude/ cleaned)
  3. Package metadata complete (pyproject.toml URLs, classifiers, description)
  4. CHANGELOG.md exists following Keep a Changelog format
  5. Deprecation policy documented in CONTRIBUTING.md
</verification>

<success_criteria>
- PKG-01: Package installs via pip from built wheel
- PKG-04: Installation validated (Windows confirmed by automation, other platforms by user)
- All 5 Phase 1 success criteria addressed
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-cleanup/01-03-SUMMARY.md`
</output>
