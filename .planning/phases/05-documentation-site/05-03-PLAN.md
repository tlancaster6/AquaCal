---
phase: 05-documentation-site
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - docs/api/index.rst
  - docs/api/core.rst
  - docs/api/calibration.rst
  - docs/api/config.rst
  - docs/api/io.rst
  - docs/api/validation.rst
  - docs/api/triangulation.rst
  - docs/api/datasets.rst
  - src/aquacal/core/refractive_geometry.py
  - src/aquacal/core/camera.py
  - src/aquacal/core/board.py
  - src/aquacal/core/interface_model.py
  - src/aquacal/calibration/pipeline.py
  - src/aquacal/calibration/intrinsics.py
  - src/aquacal/calibration/extrinsics.py
  - src/aquacal/calibration/interface_estimation.py
  - src/aquacal/calibration/refinement.py
  - src/aquacal/config/schema.py
  - src/aquacal/io/serialization.py
  - src/aquacal/io/detection.py
  - src/aquacal/io/video.py
  - src/aquacal/validation/reprojection.py
  - src/aquacal/validation/diagnostics.py
  - src/aquacal/validation/reconstruction.py
  - src/aquacal/validation/comparison.py
  - src/aquacal/triangulation/triangulate.py
  - src/aquacal/datasets/loader.py
  - src/aquacal/datasets/synthetic.py
autonomous: true

must_haves:
  truths:
    - "API reference is auto-generated from docstrings via Sphinx autodoc with napoleon extension"
    - "All public API functions and classes have complete docstrings"
    - "Key functions include brief usage examples in docstrings"
    - "API docs cross-link to relevant theory pages"
  artifacts:
    - path: "docs/api/index.rst"
      provides: "API reference landing page with summary"
      contains: "toctree"
    - path: "docs/api/core.rst"
      provides: "Core geometry API docs"
      contains: "automodule"
    - path: "docs/api/calibration.rst"
      provides: "Calibration pipeline API docs"
      contains: "automodule"
    - path: "docs/api/config.rst"
      provides: "Config and types API docs"
      contains: "automodule"
  key_links:
    - from: "docs/api/core.rst"
      to: "src/aquacal/core/refractive_geometry.py"
      via: "autodoc imports"
    - from: "src/aquacal/core/refractive_geometry.py"
      to: "docs/guide/refractive_geometry.md"
      via: "See Also in docstrings or note directives"
---

<objective>
Create complete API reference pages using Sphinx autodoc and improve public API docstrings with usage examples and cross-links to theory pages.

Purpose: Satisfy success criterion 4 — auto-generated API reference from docstrings. Make the API docs useful with examples and theory links.
Output: Full API reference for all subpackages, with improved docstrings in source code.
</objective>

<execution_context>
@C:/Users/tucke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/tucke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-documentation-site/05-01-SUMMARY.md
@.planning/phases/05-documentation-site/05-CONTEXT.md
@src/aquacal/__init__.py
@src/aquacal/core/__init__.py
@src/aquacal/calibration/__init__.py
@src/aquacal/config/__init__.py
@src/aquacal/io/__init__.py
@src/aquacal/validation/__init__.py
@src/aquacal/triangulation/__init__.py
@src/aquacal/datasets/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: API reference RST pages with autodoc directives</name>
  <files>
    docs/api/index.rst
    docs/api/core.rst
    docs/api/calibration.rst
    docs/api/config.rst
    docs/api/io.rst
    docs/api/validation.rst
    docs/api/triangulation.rst
    docs/api/datasets.rst
  </files>
  <action>
  Create API reference pages using RST with autodoc directives (RST for API pages where autodoc is heavy, per research recommendation).

  1. Create `docs/api/index.rst` — API landing page:
     - Title: "API Reference"
     - Brief intro: "Complete reference for all public modules, classes, and functions."
     - Toctree listing all subpackage pages
     - Brief description of each subpackage (1 line each)

  2. Create `docs/api/core.rst` — Core Geometry:
     - Group by functionality (not flat automodule):
       - "Refractive Projection" section: `refractive_project`, `refractive_project_batch`, `refractive_project_fast`
       - "Snell's Law" section: `snells_law_3d`, `trace_ray_air_to_water`
       - "Camera Models" section: `Camera`, `FisheyeCamera` classes
       - "Board Geometry" section: `automodule:: aquacal.core.board`
       - "Interface Model" section: `automodule:: aquacal.core.interface_model`
     - Add a note at the top: "For theory behind these functions, see :doc:`/guide/refractive_geometry` and :doc:`/guide/coordinates`."

  3. Create `docs/api/calibration.rst` — Calibration Pipeline:
     - "Pipeline" section: `automodule:: aquacal.calibration.pipeline`
     - "Stage 1: Intrinsics" section: `automodule:: aquacal.calibration.intrinsics`
     - "Stage 2: Extrinsics" section: `automodule:: aquacal.calibration.extrinsics`
     - "Stage 3: Interface Estimation" section: `automodule:: aquacal.calibration.interface_estimation`
     - "Stage 4: Refinement" section: `automodule:: aquacal.calibration.refinement`
     - Note: Do NOT include `_optim_common.py` (private module, underscore prefix)
     - Add note linking to :doc:`/guide/optimizer`

  4. Create `docs/api/config.rst` — Configuration & Types:
     - `automodule:: aquacal.config.schema` with `:members:` and `:show-inheritance:`
     - This covers all dataclasses: CalibrationConfig, CalibrationResult, CameraCalibration, etc.

  5. Create `docs/api/io.rst` — I/O:
     - Sections for serialization, detection, video modules
     - `automodule` for each

  6. Create `docs/api/validation.rst` — Validation & Diagnostics:
     - Sections for reprojection, reconstruction, diagnostics, comparison
     - `automodule` for each

  7. Create `docs/api/triangulation.rst`:
     - `automodule:: aquacal.triangulation.triangulate`

  8. Create `docs/api/datasets.rst`:
     - `automodule:: aquacal.datasets.loader`
     - `automodule:: aquacal.datasets.synthetic`
     - Note: Do NOT include private `_manifest.py`
  </action>
  <verify>
  `python -m sphinx docs docs/_build -b html` builds. Check that API pages show function signatures, docstrings, and parameter documentation. Verify cross-reference links to theory pages work.
  </verify>
  <done>
  API reference pages exist for all 7 subpackages with autodoc directives. Pages are grouped by functionality, not flat module dumps. Theory page cross-links are present. Private modules excluded.
  </done>
</task>

<task type="auto">
  <name>Task 2a: Improve docstrings for core and calibration modules</name>
  <files>
    src/aquacal/core/refractive_geometry.py
    src/aquacal/core/camera.py
    src/aquacal/core/board.py
    src/aquacal/core/interface_model.py
    src/aquacal/calibration/pipeline.py
    src/aquacal/calibration/intrinsics.py
    src/aquacal/calibration/extrinsics.py
    src/aquacal/calibration/interface_estimation.py
    src/aquacal/calibration/refinement.py
  </files>
  <action>
  Review and improve docstrings for all PUBLIC functions and classes in core/ and calibration/ modules.

  **Priority 1 — Key functions needing 3-5 line usage examples** (per user decision):
  - `refractive_project()` / `refractive_project_batch()` / `refractive_project_fast()` — Example showing projection of a 3D point
  - `snells_law_3d()` — Example showing refraction of a ray
  - `Camera` class — Example creating a camera and projecting
  - `run_calibration()` — Example calling with config path

  **Priority 2 — Complete missing docstrings:**
  - Scan each public module's `__all__` or public functions (no underscore prefix)
  - Ensure each has: one-line summary, Args section with types, Returns section
  - Internal/private items (underscore prefix) can stay sparse

  **Priority 3 — Cross-links to theory pages:**
  - In `snells_law_3d` and refractive projection functions, add Note referencing :doc:`/guide/refractive_geometry`
  - In `Camera` docstring, reference :doc:`/guide/coordinates`
  - In pipeline functions, reference :doc:`/guide/optimizer`
  - Example format:
    ```
    Note:
        For a detailed explanation of the refractive geometry model,
        see the :doc:`Refractive Geometry </guide/refractive_geometry>` guide.
    ```

  **Important:** Do NOT modify function signatures, logic, or behavior. Only docstrings.
  Keep existing docstring content — add to it, don't replace.
  Use Google-style docstrings (project convention).
  </action>
  <verify>
  `python -m sphinx docs docs/_build -b html` builds without errors. Spot-check core and calibration API pages to verify usage examples and cross-links render correctly.
  Run `python -m pytest tests/ -m "not slow" -x` to ensure docstring changes didn't break anything.
  </verify>
  <done>
  Core and calibration public functions have complete Args/Returns documentation. Key functions (refractive_project, snells_law_3d, Camera, run_calibration) have 3-5 line usage examples. Cross-links to theory pages work. Tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2b: Improve docstrings for io, config, validation, triangulation, and datasets modules</name>
  <files>
    src/aquacal/config/schema.py
    src/aquacal/io/serialization.py
    src/aquacal/io/detection.py
    src/aquacal/io/video.py
    src/aquacal/validation/reprojection.py
    src/aquacal/validation/diagnostics.py
    src/aquacal/validation/reconstruction.py
    src/aquacal/validation/comparison.py
    src/aquacal/triangulation/triangulate.py
    src/aquacal/datasets/loader.py
    src/aquacal/datasets/synthetic.py
  </files>
  <action>
  Review and improve docstrings for all PUBLIC functions and classes in config/, io/, validation/, triangulation/, and datasets/ modules.

  **Priority 1 — Key functions needing 3-5 line usage examples** (per user decision):
  - `CalibrationResult` — Example accessing fields
  - `load_calibration()` / `save_calibration()` — Example round-trip
  - `load_example()` / `generate_synthetic_rig()` — Example loading data

  **Priority 2 — Complete missing docstrings:**
  - Scan each public module's `__all__` or public functions (no underscore prefix)
  - Ensure each has: one-line summary, Args section with types, Returns section
  - Internal/private items (underscore prefix) can stay sparse

  **Priority 3 — Cross-links to theory pages:**
  - In validation functions, add Note referencing :doc:`/guide/refractive_geometry` where relevant
  - In `CalibrationResult` and config dataclasses, reference :doc:`/guide/coordinates` for coordinate conventions

  **Important:** Do NOT modify function signatures, logic, or behavior. Only docstrings.
  Keep existing docstring content — add to it, don't replace.
  Use Google-style docstrings (project convention).
  </action>
  <verify>
  `python -m sphinx docs docs/_build -b html` builds without errors. Spot-check io, validation, triangulation, and datasets API pages to verify usage examples and complete documentation render correctly.
  Run `python -m pytest tests/ -m "not slow" -x` to ensure docstring changes didn't break anything.
  </verify>
  <done>
  Config, io, validation, triangulation, and datasets public functions have complete Args/Returns documentation. Key functions (CalibrationResult, load/save_calibration, load_example, generate_synthetic_rig) have 3-5 line usage examples. Cross-links to theory pages work. Tests pass.
  </done>
</task>

</tasks>

<verification>
1. `python -m sphinx docs docs/_build -b html` builds without errors or warnings about missing modules
2. API landing page lists all subpackages with brief descriptions
3. Core API page shows `refractive_project()` with usage example and link to theory page
4. Calibration API page shows pipeline stages in order
5. Config API page shows all dataclasses with field documentation
6. `python -m pytest tests/ -m "not slow" -x` passes (docstring changes are non-breaking)
7. At least 5 key functions have inline usage examples visible in rendered docs
</verification>

<success_criteria>
API reference auto-generated from docstrings via autodoc. All public API has complete docstrings. Key functions have usage examples. Cross-links to theory pages work. Tests pass.
</success_criteria>

<output>
After completion, create `.planning/phases/05-documentation-site/05-03-SUMMARY.md`
</output>
