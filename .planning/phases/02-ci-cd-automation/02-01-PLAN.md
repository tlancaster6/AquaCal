---
phase: 02-ci-cd-automation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .pre-commit-config.yaml
  - pyproject.toml
autonomous: true

must_haves:
  truths:
    - "Ruff lints and formats code when pre-commit hooks run"
    - "Dev dependencies include ruff and pytest-cov, not black or mypy"
    - "Coverage configuration excludes test files and standard boilerplate"
    - "Ruff lint rules are lenient (E, F, W, I) per user decision"
  artifacts:
    - path: ".pre-commit-config.yaml"
      provides: "Pre-commit hook configuration with ruff and quality-of-life hooks"
      contains: "ruff"
    - path: "pyproject.toml"
      provides: "Ruff config, coverage config, updated dev deps"
      contains: "tool.ruff"
  key_links:
    - from: ".pre-commit-config.yaml"
      to: "pyproject.toml"
      via: "ruff reads config from pyproject.toml"
      pattern: "tool\\.ruff"
---

<objective>
Create pre-commit configuration and update pyproject.toml with ruff (replacing black), coverage settings, and updated dev dependencies.

Purpose: Foundation for all CI workflows -- ruff config is referenced by pre-commit CI job, coverage config by test workflows, and dev deps by pip install in CI.
Output: .pre-commit-config.yaml and updated pyproject.toml
</objective>

<execution_context>
@C:/Users/tucke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/tucke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ci-cd-automation/02-RESEARCH.md
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update pyproject.toml with ruff config, coverage config, and dev deps</name>
  <files>pyproject.toml</files>
  <action>
Update pyproject.toml with three changes:

1. **Replace dev dependencies**: Remove `black`, `mypy`, and `types-PyYAML` from `[project.optional-dependencies] dev`. Add `ruff` and `pre-commit`. Keep `pytest` and `pytest-cov`. Per user decision: mypy skipped (numpy stubs too rough), ruff replaces black.

2. **Add ruff configuration**:
```toml
[tool.ruff]
line-length = 88
target-version = "py310"
exclude = [".git", ".venv", "__pycache__", "build", "dist"]

[tool.ruff.lint]
select = ["E4", "E7", "E9", "F", "W", "I"]
ignore = []
fixable = ["ALL"]

[tool.ruff.lint.per-file-ignores]
"__init__.py" = ["F401"]
"tests/**/*.py" = ["E501"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
```
Per user decision: lenient rules (E, F, W, I). Start lenient, tighten later.

3. **Add coverage configuration**:
```toml
[tool.coverage.run]
source = ["src/aquacal"]
omit = ["*/tests/*", "*/test_*.py", "*/__pycache__/*"]

[tool.coverage.report]
precision = 2
show_missing = true
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise AssertionError",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "if TYPE_CHECKING:",
    "@abstractmethod",
]
```
  </action>
  <verify>Run `python -c "import tomllib; d=tomllib.load(open('pyproject.toml','rb')); print(d['tool']['ruff']); print(d['tool']['coverage']); print(d['project']['optional-dependencies']['dev'])"` and confirm ruff config, coverage config, and updated dev deps are present. Confirm black/mypy are NOT in dev deps.</verify>
  <done>pyproject.toml has ruff config (lenient rules), coverage config, and dev deps list with ruff+pre-commit instead of black+mypy</done>
</task>

<task type="auto">
  <name>Task 2: Create .pre-commit-config.yaml with ruff and quality-of-life hooks</name>
  <files>.pre-commit-config.yaml</files>
  <action>
Create `.pre-commit-config.yaml` at project root with:

```yaml
repos:
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.15.1
    hooks:
      - id: ruff
        args: [--fix]
      - id: ruff-format

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
        args: ['--maxkb=1000']
```

IMPORTANT: ruff hook (with --fix) MUST come before ruff-format. Fixes may produce code needing reformatting.

Per research: include standard quality-of-life hooks (trailing-whitespace, end-of-file-fixer, check-yaml, check-added-large-files). Skip debug-statements (overly aggressive).
  </action>
  <verify>Run `python -c "import yaml; c=yaml.safe_load(open('.pre-commit-config.yaml')); hooks=[h['id'] for r in c['repos'] for h in r['hooks']]; print(hooks)"` and confirm hooks list is `['ruff', 'ruff-format', 'trailing-whitespace', 'end-of-file-fixer', 'check-yaml', 'check-added-large-files']`. Confirm ruff comes before ruff-format.</verify>
  <done>.pre-commit-config.yaml exists with ruff (--fix) before ruff-format, plus 4 quality-of-life hooks from pre-commit-hooks v5.0.0</done>
</task>

</tasks>

<verification>
- pyproject.toml contains `[tool.ruff]` and `[tool.coverage.run]` sections
- Dev deps include ruff, pre-commit, pytest, pytest-cov (no black, no mypy)
- .pre-commit-config.yaml exists with correct hook ordering
- Ruff lint rules match user decision: E4, E7, E9, F, W, I
</verification>

<success_criteria>
- pyproject.toml updated with ruff config, coverage config, and corrected dev deps
- .pre-commit-config.yaml created with ruff and quality-of-life hooks
- No references to black or mypy remain in dev dependencies
</success_criteria>

<output>
After completion, create `.planning/phases/02-ci-cd-automation/02-01-SUMMARY.md`
</output>
